# Next JS Server Side

All the routes are configures with ISR build,

Next.js' Incremental Static Regeneration (ISR) feature allows us to update the
website's pre-rendered pages on-demand in the background, providing users with
the latest content without having to rebuild the entire site.

Current revalidation interval `30 seconds`

Here is an example of how the API's data is validated before making it available
to the frontend props.

```tsx
import { useStaticProps } from "next";
import fetch from "node-fetch";
import * as z from "zod";

import * as sentry from "../sentry";

// Define a zod schema for the movie data
const Movie = z.object({
	id: z.string(),
	title: z.string(),
	director: z.string(),
	rating: z.number(),
});

const Movies = z.array(Movie);

export const getStaticProps = async () => {
	try {
		// Fetch the data from Strapi
		const response = await fetch(
			`${process.env.NEXT_PUBLIC_STRAPI_URL}/movies`,
		);
		const json = await response.json();

		// Validate the data using the zod schema
		const movies = Movies.parse(json);

		// Transform the data for the frontend
		const transformedMovies = movies.map((movie) => ({
			id: movie.id,
			title: movie.title,
			director: movie.director,
			rating: movie.rating,
		}));

		// Validate the transformed data using the zod schema
		const validatedMovies = Movies.parse(transformedMovies);

		// Return the data to the component
		return {
			props: {
				movies: validatedMovies,
			},
			revalidate: 1,
		};
	} catch (error) {
		// Log the error using the sentry module
		captureSentryException(error);

		// Throw error
		return throwErrorWithMessage(error, "Error Message");
	}
};
```

- The **`getStaticProps`** function first fetches the movie data from Strapi
  using the **`fetch`** function. It then validates the data using the
  **`Movie`** and **`Movies`** schemas defined earlier.
- Next, it transforms the data by extracting only the necessary properties and
  formatting them in the desired way. This transformed data is validated again
  using the **`Movies`** schema to ensure that it still matches the expected
  shape and type.
- Finally, the validated and transformed data is returned to the component using
  the **`props`** property of the return value of the **`getStaticProps`**
  function and also revalidate the data in `30` seconds(ISR) to stay upto date
  with the latest data.
- If an error occurs while fetching or validating the data, it is logged using
  the **`sentry`** module and an error thrown. This ensures that the component
  will fail to render and still show the previously available site in cache.

## Show Page

The show page is generated by combining the show name and show key with a
package called Slugify, and the resulting string is used as the slug for the
show page's URL. For example, if the show name is "Game of Thrones" and the show
key is "got", the show page's URL might be "/show/game-of-thrones-got".

## Watch Page

The watch page is generated in a similar way, but it uses the video key as the
slug for the URL. For example, if the video key is "s1e1", the watch page's URL
might be "/watch/s1e1". This allows users to easily access and watch specific
videos on the website.
